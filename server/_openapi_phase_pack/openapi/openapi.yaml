# PATH: server/openapi/openapi.yaml
# --- REPLACE START
openapi: 3.1.0
info:
  title: Loventia API
  version: 1.0.0
  description: |
    OpenAPI specification for the Loventia dating application.

    This spec is aligned with the current server/src/app.js routing we just test-drove
    with PowerShell:

      - Primary auth endpoint: POST /api/auth/login
      - Legacy/fallback auth endpoint: POST /api/users/login
      - Refresh: POST /api/auth/refresh
      - Self: GET /api/auth/me and GET /api/users/me and GET /api/me
      - Reset-password flow: POST /api/auth/forgot-password, POST /api/auth/reset-password
      - Private diagnostics: GET /api/auth/private/ping, GET /api/auth/private/no-me
      - User photo management (the things we just tested): 
          * DELETE /api/users/{userId}/photos/{slot}
          * DELETE /api/users/{userId}/photos?path=...
          * PUT    /api/users/{userId}/photos/reorder
          * POST   /api/users/{userId}/set-avatar
      - Billing endpoints (Stripe webhook at /webhooks/stripe and legacy /api/payment/stripe-webhook)
      - Admin CSV exports
      - Health/readiness endpoints

    IMPORTANT:
      - We **document both** logins on purpose:
          1) /api/auth/login  (main, preferred)
          2) /api/users/login (legacy/fallback)
      - This matches the README change you will add in server/README.md

servers:
  - url: http://localhost:5000
    description: Local backend (root, for /health etc.)
  - url: http://localhost:5000/api
    description: Local backend API base (/api/*)

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    AuthLoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: villehermaala1981@gmail.com
        password:
          type: string
          example: Paavali1981
    AuthLoginResponse:
      type: object
      properties:
        message:
          type: string
          example: Login successful.
        user:
          $ref: '#/components/schemas/UserSelf'
        accessToken:
          type: string
        refreshToken:
          type: string
        expiresIn:
          type: integer
          example: 7200
        refreshExpiresIn:
          type: integer
          nullable: true

    AuthRefreshRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string

    AuthRefreshResponse:
      type: object
      properties:
        accessToken:
          type: string
        user:
          $ref: '#/components/schemas/UserSelf'

    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          example: testuser1@example.com

    ResetPasswordRequest:
      type: object
      required:
        - token
        - password
      properties:
        token:
          type: string
          description: Reset token from email link
        password:
          type: string
          format: password
          minLength: 6
        id:
          type: string
          description: Optional user ID if backend expects it

    UserSelf:
      type: object
      description: >
        Minimal user shape returned by /api/auth/me and /api/users/me in our PS tests.
        Includes entitlements, visibility and premium flags.
      properties:
        id:
          type: string
          example: 68dab8a761a412065159ff4d
        _id:
          type: string
          example: 68dab8a761a412065159ff4d
        email:
          type: string
          example: villehermaala1981@gmail.com
        username:
          type: string
          example: Ville1981
        role:
          type: string
          example: user
        premium:
          type: boolean
          example: true
        isPremium:
          type: boolean
          example: true
        entitlements:
          type: object
          properties:
            tier:
              type: string
              example: premium
            since:
              type: string
              nullable: true
            until:
              type: string
              nullable: true
            features:
              type: object
              additionalProperties: true
            quotas:
              type: object
              additionalProperties: true
        visibility:
            type: object
            properties:
              isHidden:
                type: boolean
                example: false
              hiddenUntil:
                type: string
                nullable: true
              resumeOnLogin:
                type: boolean
                example: true
        profilePicture:
          type: string
          example: /uploads/1759343842730-848316731.gif
        photos:
          type: array
          items:
            type: string
            example: /uploads/1759343842730-848316731.gif
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Image:
      type: object
      properties:
        id:
          type: string
          example: img_123
        url:
          type: string
          example: /uploads/user-1/avatar.png
        owner:
          type: string
          example: 68dab8a761a412065159ff4d
        is_profile_picture:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
        uploaded:
          type: string
          format: date-time

    UserPhotosReorderRequest:
      type: object
      required:
        - order
      properties:
        order:
          type: array
          description: >
            Full ordered list of photo paths, exactly like we sent from PowerShell:
            { "order": ["/uploads/x.gif", "/uploads/y.gif", ...] }
          items:
            type: string
            example: /uploads/1759343842730-848316731.gif

    Feedback:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
          format: email
        message:
          type: string
        rating:
          type: integer
          minimum: 1
          maximum: 5

paths:

  /api/discover:
    get:
      tags: [Discover]
      summary: Discover profiles
      description: Returns a paginated list of public profile cards.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: minAge
          schema: { type: integer, minimum: 18 }
        - in: query
          name: maxAge
          schema: { type: integer, minimum: 18 }
        - in: query
          name: gender
          schema: { type: string }
        - in: query
          name: distanceKm
          schema: { type: number }
        - in: query
          name: lat
          schema: { type: number }
        - in: query
          name: lng
          schema: { type: number }
        - in: query
          name: page
          schema: { type: integer, minimum: 1, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, default: 20 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProfileCard'
                  meta:
                    $ref: '#/components/schemas/Pagination'
        '401': { description: Unauthorized }

  /api/discover/search:
    post:
      deprecated: true
      tags: [Discover]
      summary: Legacy discover search
      description: Deprecated legacy route kept for backward compatibility. Accepts the same shape as GET /api/discover (query) but in JSON body.
      security: [{ bearerAuth: [] }]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiscoverQuery'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProfileCard'
                  meta:
                    $ref: '#/components/schemas/Pagination'
        '401': { description: Unauthorized }

  /api/likes/incoming:
    get:
      tags: [Likes]
      security: [{ bearerAuth: [] }]
      summary: List users who liked me
      responses:
        '200':
          description: OK

  /api/likes/outgoing:
    get:
      tags: [Likes]
      security: [{ bearerAuth: [] }]
      summary: List users I liked
      responses:
        '200':
          description: OK

  /api/likes/matches:
    get:
      tags: [Likes]
      security: [{ bearerAuth: [] }]
      summary: List matches
      responses:
        '200':
          description: OK

  /api/likes/{id}:
    post:
      tags: [Likes]
      security: [{ bearerAuth: [] }]
      summary: Like a user
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }
    delete:
      tags: [Likes]
      security: [{ bearerAuth: [] }]
      summary: Unlike a user
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/superlikes/{id}:
    post:
      tags: [Likes]
      security: [{ bearerAuth: [] }]
      summary: Superlike a user
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/messages/overview:
    get:
      tags: [Messages]
      security: [{ bearerAuth: [] }]
      summary: List conversation summaries
      responses:
        '200': { description: OK }

  /api/messages/can-send-intro/{userId}:
    get:
      tags: [Messages]
      security: [{ bearerAuth: [] }]
      summary: Whether current user can send intro to userId
      parameters:
        - in: path
          name: userId
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/messages/{userId}:
    get:
      tags: [Messages]
      security: [{ bearerAuth: [] }]
      summary: Get a thread with userId
      parameters:
        - in: path
          name: userId
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }
    post:
      tags: [Messages]
      security: [{ bearerAuth: [] }]
      summary: Send a message to userId
      parameters:
        - in: path
          name: userId
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendMessageBody'
      responses:
        '201': { description: Created }

  /api/billing/create-checkout-session:
    post:
      tags: [Billing]
      security: [{ bearerAuth: [] }]
      summary: Create Stripe Checkout session
      responses:
        '200': { description: OK }

  /api/billing/create-portal-session:
    post:
      tags: [Billing]
      security: [{ bearerAuth: [] }]
      summary: Create Stripe billing portal session
      responses:
        '200': { description: OK }

  /api/billing/sync:
    post:
      tags: [Billing]
      security: [{ bearerAuth: [] }]
      summary: Force sync premium status from Stripe
      responses:
        '200': { description: OK }

  # ======================================================
  # AUTHENTICATION — the two login endpoints on purpose
  # ======================================================
  /api/auth/login:
    post:
      tags: [Authentication]
      summary: Login (primary)
      description: >
        Primary login endpoint for Loventia. FE calls this FIRST.
        If it returns 404/405, FE may try /api/users/login (legacy).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthLoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthLoginResponse'
        '400':
          description: Invalid credentials or missing payload

  /api/users/login:
    post:
      tags: [Authentication]
      summary: Login (legacy/fallback)
      description: >
        Legacy/fallback login. Keep documented so new devs see we support
        BOTH `/api/auth/login` and `/api/users/login` for now.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthLoginRequest'
      responses:
        '200':
          description: Login successful (legacy route)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthLoginResponse'
        '404':
          description: This legacy route is not mounted in this environment

  /api/auth/refresh:
    post:
      tags: [Authentication]
      summary: Refresh access token
      description: >
        Matches the PS call: POST /api/auth/refresh { "refreshToken": "<token>" }
        Returns a fresh access token and user payload.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRefreshRequest'
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthRefreshResponse'
        '401':
          description: Invalid or expired refresh token

  /api/auth/me:
    get:
      tags: [Authentication]
      summary: Get current user (auth router)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user (from auth router)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSelf'
        '401':
          description: Unauthorized

  /api/me:
    get:
      tags: [Authentication]
      summary: Get current user (central route)
      description: >
        Centralized self-route. We confirmed with PS that this returns
        the same normalized shape as /api/auth/me.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user (centralized)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSelf'
        '401':
          description: Unauthorized

  /api/users/me:
    get:
      tags: [Users]
      summary: Get current user (users router)
      description: >
        You also exposed /api/users/me. This returns almost identical data,
        so we document it here so consumers know BOTH exist right now.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user (from users router)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSelf'
        '401':
          description: Unauthorized

  /api/auth/logout:
    post:
      tags: [Authentication]
      summary: Logout (stateless)
      description: >
        Stateless logout. PowerShell test showed:
        { "message": "Logout successful" }
        and existing access token still worked (expected with stateless).
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout acknowledged
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logout successful

  /api/auth/forgot-password:
    post:
      tags: [Authentication]
      summary: Request password reset email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
      responses:
        '200':
          description: Reset email sent (or noop for security)
        '400':
          description: Invalid email

  /api/auth/reset-password:
    post:
      tags: [Authentication]
      summary: Reset password with token
      description: >
        Matches FE flow: POST /api/auth/reset-password { token, password, id? }
        BE responds "Password has been reset successfully."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        '200':
          description: Password has been reset successfully.
        '400':
          description: Invalid or expired token

  /api/auth/private/ping:
    get:
      tags: [Authentication]
      summary: Private auth ping
      description: >
        Returns a diagnostic object (we saw this in PS).
        Confirms that private auth router is mounted.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Private auth router is mounted
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  router:
                    type: string
                    example: authPrivateRoutes

  /api/auth/private/no-me:
    get:
      tags: [Authentication]
      summary: Private router explanation for /me
      description: >
        Explicitly tells client to use /api/auth/me and that this router
        does NOT define /me on purpose.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Explanation returned

  # ===================================
  # USER PHOTO OPS — THIS SESSION
  # ===================================
  /api/users/{userId}/photos:
    delete:
      tags: [Users, Images]
      summary: Delete a photo by its exact path (query)
      description: >
        This is the call we tested:
        DELETE /api/users/{id}/photos?path=/uploads/xxx.gif
        Server normalizes the path and removes it from both photos and extraImages.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
          description: User ID whose photo is being deleted
        - in: query
          name: path
          required: true
          schema:
            type: string
          description: Exact (or nearly exact) upload path, e.g. /uploads/1759....gif
      responses:
        '200':
          description: Updated user object after deletion
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSelf'
        '400':
          description: Path missing or invalid
        '404':
          description: Path not found in user photos
    post:
      tags: [Users, Images]
      summary: Upload one or more photos for user
      description: >
        Multer-backed upload. In PowerShell you will need to use -Form / -InFile
        pattern. This is the REST shape; actual controller is in users router.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                photos:
                  type: array
                  items:
                    type: string
                    format: binary
              required:
                - photos
      responses:
        '201':
          description: Photos uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSelf'
        '400':
          description: Upload failed

  /api/users/{userId}/photos/{slot}:
    delete:
      tags: [Users, Images]
      summary: Delete a photo by slot index
      description: >
        This is the simpler delete:
        DELETE /api/users/{id}/photos/0
        We tested this and it removed the first image and shifted the rest.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
        - in: path
          name: slot
          required: true
          schema:
            type: integer
          description: Index of photo to delete
      responses:
        '200':
          description: Updated user object after deletion
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSelf'
        '404':
          description: Slot not found

  /api/users/{userId}/photos/reorder:
    put:
      tags: [Users, Images]
      summary: Reorder user's photos
      description: >
        This matches the PS call we made:
        PUT /api/users/{id}/photos/reorder
        { "order": ["/uploads/last.gif", "/uploads/first.gif", ...] }
        Server also updates profilePicture = first item.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserPhotosReorderRequest'
      responses:
        '200':
          description: Reordered, user returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSelf'
        '400':
          description: Invalid order array

  /api/users/{userId}/set-avatar:
    post:
      tags: [Users, Images]
      summary: Set user's avatar/profile picture from existing photos
      description: >
        Matches PS call:
        POST /api/users/{id}/set-avatar { "path": "/uploads/...gif" }
        Server normalizes and sets profilePicture/avatar/profilePhoto.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - path
              properties:
                path:
                  type: string
                  example: /uploads/1759343842730-848316731.gif
      responses:
        '200':
          description: Avatar updated, user returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSelf'
        '400':
          description: Path not in user's photos

  # ===================================
  # IMAGES (generic) — keep as before
  # ===================================
  /api/profile/images:
    post:
      tags: [Images]
      summary: Upload a new user image
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              required:
                - file
      responses:
        '201':
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - upload limit reached
        '415':
          description: Unsupported Media Type
        '413':
          description: Payload Too Large
    get:
      tags: [Images]
      summary: List user's images
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of user images
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Image'
        '401':
          description: Unauthorized

  /api/profile/images/{imageId}:
    delete:
      tags: [Images]
      summary: Delete a user image
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: imageId
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Image deleted
        '401':
          description: Unauthorized
        '404':
          description: Image not found

  /api/users/{userId}/upload-avatar:
    post:
      tags: [Images]
      summary: Upload a profile avatar for a user
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
          description: ID of the user uploading the image
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              required:
                - file
      responses:
        '201':
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - upload limit reached or wrong user
        '500':
          description: Server error

  # ===================================
  # BILLING / STRIPE
  # ===================================
  /webhooks/stripe:
    post:
      tags: [Billing]
      summary: Stripe webhook (raw body)
      description: >
        Real webhook endpoint as mounted in server/src/app.js:
        app.post('/webhooks/stripe', express.raw({ type: 'application/json' }), ...)
        Requires Stripe-Signature header. Raw body is required.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Acknowledged
        '400':
          description: Invalid signature or payload

  /api/payment/stripe-webhook:
    post:
      tags: [Billing]
      summary: Stripe webhook (legacy/compat)
      description: >
        Legacy or alternate path for Stripe webhooks. Keep for backward
        compatibility with older clients or Stripe CLI setups.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Acknowledged
        '400':
          description: Invalid signature or payload

  # NOTE: /api/billing/sync is defined above in Billing section.
  # (We intentionally avoid defining it twice to keep YAML keys unique.)

  /api/payment/mock/checkout-complete:
    post:
      tags: [Billing]
      summary: (TEST) Set premium ON
      description: >
        Test-only endpoint, enabled when STRIPE_MOCK_MODE=1. Requires auth.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Premium flipped ON

  /api/payment/mock/subscription-canceled:
    post:
      tags: [Billing]
      summary: (TEST) Set premium OFF
      description: >
        Test-only endpoint, enabled when STRIPE_MOCK_MODE=1. Requires auth.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Premium flipped OFF

  # ===================================
  # ADMIN CSV EXPORTS
  # ===================================
  /api/admin/export/users.csv:
    get:
      tags: [Admin]
      summary: Export users as CSV
      security:
        - bearerAuth: []
      responses:
        '200':
          description: CSV file
          content:
            text/csv:
              schema:
                type: string
                format: binary
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin only)

  /api/admin/export/matches.csv:
    get:
      tags: [Admin]
      summary: Export matches as CSV
      security:
        - bearerAuth: []
      responses:
        '200':
          description: CSV file
          content:
            text/csv:
              schema:
                type: string
                format: binary

  /api/admin/export/messages.csv:
    get:
      tags: [Admin]
      summary: Export messages as CSV
      description: >
        Optional filters: from (ISO), to (ISO), limit (1..200000)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 200000
      responses:
        '200':
          description: CSV file
          content:
            text/csv:
              schema:
                type: string
                format: binary

  /api/admin/export/conversations.csv:
    get:
      tags: [Admin]
      summary: Export conversations as CSV
      description: >
        Groups messages by user pair (threadKey). Supports from/to/limit.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 200000
      responses:
        '200':
          description: CSV file
          content:
            text/csv:
              schema:
                type: string
                format: binary

  /api/admin/export/billing-events.csv:
    get:
      tags: [Admin]
      summary: Export billing events as CSV
      description: >
        Export Stripe webhook events that were logged. Requires STRIPE_LOG_EVENTS=1.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: CSV file
          content:
            text/csv:
              schema:
                type: string
                format: binary

  /api/admin/export/billing-subscriptions.csv:
    get:
      tags: [Admin]
      summary: Export billing subscriptions as CSV
      security:
        - bearerAuth: []
      responses:
        '200':
          description: CSV file
          content:
            text/csv:
              schema:
                type: string
                format: binary

  # ===================================
  # HEALTH / DIAGNOSTICS
  # ===================================
  /health:
    get:
      tags: [Health]
      summary: Liveness probe
      responses:
        '200':
          description: OK

  /healthz:
    get:
      tags: [Health]
      summary: Liveness probe (alt)
      responses:
        '200':
          description: OK

  /readiness:
    get:
      tags: [Health]
      summary: Readiness probe
      description: >
        Returns 200 when dependencies are OK; 503 otherwise.
      responses:
        '200':
          description: Ready
        '503':
          description: Not ready

  /__routes:
    get:
      tags: [Diagnostics]
      summary: List app-level routes (dev-only)
      responses:
        '200':
          description: List of routes

  /__routes_api:
    get:
      tags: [Diagnostics]
      summary: List /api router routes (dev-only)
      responses:
        '200':
          description: List of /api routes

  /__routes_api_full:
    get:
      tags: [Diagnostics]
      summary: List /api router routes (detailed)
      responses:
        '200':
          description: Detailed list of /api routes

security:
  - bearerAuth: []
# --- REPLACE END


