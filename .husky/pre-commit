#!/usr/bin/env sh
set -eu

echo "pre-commit: start"

# In CI always run tests (workflows handle this anyway, but safe)
if [ -n "${CI:-}" ]; then
  echo "CI detected -> running npm test"
  npm test
  exit $?
fi

# Run tests only if vitest exists (deps installed)
if [ -f "./client/node_modules/.bin/vitest" ] || [ -f "./node_modules/.bin/vitest" ]; then
  echo "vitest found -> running npm test"
  npm test
  exit $?
fi

echo "pre-commit: vitest not found (install not complete). Skipping local tests."
echo "Tip: fix node-gyp/VS Build Tools and run npm install (workspaces) later."
exit 0